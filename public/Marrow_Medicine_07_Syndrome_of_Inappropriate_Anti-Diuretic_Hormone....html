<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07_Syndrome of Inappropriate Anti-Diuretic Hormone... - Marrow Medicine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .medical-quiz {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .question-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        
        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }
        
        .option-card.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.3s;
        }
        
        .medical-image {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }
        
        .hidden {
            display: none !important;
        }

        .explanation-content {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.05rem;
            line-height: 1.7;
            color: #374151;
            text-align: left;
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .explanation-content strong, .explanation-content b {
            font-weight: 600;
            color: #1f2937;
        }
        
        .explanation-content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen medical-quiz">
    <header class="bg-white shadow-xl p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">07_Syndrome of Inappropriate Anti-Diuretic Hormone...</h1>
                <p class="text-gray-600 mt-2">Marrow ‚Ä¢ Medicine ‚Ä¢ Interactive Learning</p>
            </div>
            <div class="flex gap-2">
                <button class="bg-gray-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-gray-600 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    ‚Üê Topics
                </button>
                <button class="bg-purple-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-purple-600 transition" 
                        onclick="window.location.href='marrow.html'">
                    üìö Marrow
                </button>
                <button class="bg-blue-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-blue-600 transition" 
                        onclick="window.location.href='index.html'">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar (Hidden in Test Mode) -->
    <div class="bg-white shadow-lg p-4" id="stats-bar">
        <div class="container mx-auto flex justify-center gap-8">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="correct-stats">0</div>
                <div class="text-sm text-gray-600">Correct</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="incorrect-stats">0</div>
                <div class="text-sm text-gray-600">Incorrect</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="accuracy-stats">0%</div>
                <div class="text-sm text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="progress-stats">0/9</div>
                <div class="text-sm text-gray-600">Progress</div>
            </div>
        </div>
    </div>

    <!-- Quiz Section -->
    <section class="container mx-auto p-6" id="quiz-section">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-8">
                <div class="progress-bar h-4 rounded-full" id="progress-bar"></div>
            </div>

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-blue-700" id="question-number">Question 1 of 9</h2>
                <div class="text-sm text-gray-600" id="question-status">Click an option to answer</div>
            </div>

            <!-- Question Text -->
            <div class="mb-10">
                <div class="question-card text-white p-8 rounded-2xl mb-8" id="question-text"></div>
                
                <!-- Question Image -->
                <div class="text-center mb-8" id="question-images"></div>
                
                <!-- Options -->
                <div class="space-y-4" id="options"></div>
            </div>

            <!-- Answer Feedback Section (Normal Mode Only) -->
            <div class="hidden mb-8 p-6 rounded-2xl" id="feedback-section">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2" id="feedback-icon"></div>
                    <div class="text-2xl font-bold mb-2" id="feedback-message">Correct!</div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Your Answer:</strong><br>
                        <span id="user-answer-display"></span>
                    </div>
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Correct Answer:</strong><br>
                        <span class="text-green-600" id="correct-answer-display"></span>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl" id="explanation-section">
                    <strong class="text-lg text-blue-800">Explanation:</strong>
                    <div id="explanation-content" class="mt-3 explanation-content"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between gap-4">
                <button class="bg-gray-400 text-white px-6 py-3 rounded-xl hover:bg-gray-500 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                
                <div class="flex gap-4">
                    <button class="bg-gray-400 text-white px-6 py-3 rounded-xl disabled" id="prev-btn">
                        Previous
                    </button>
                    <button class="bg-blue-500 text-white px-6 py-3 rounded-xl hidden" id="next-btn">
                        Next
                    </button>
                    <button class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hidden" id="finish-btn">
                        Finish Quiz
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="test-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Test Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="test-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="test-final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="test-final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="test-final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>

            <!-- Detailed Review -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed Review</h3>
                <div id="test-review-details" class="space-y-4"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <!-- Normal Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="final-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Quiz Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="final-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <script>
        const questions = [
  {
    "id": 102,
    "text": "Q1. Which of the following findings will you not expect to see in a patient with SIADH?",
    "options": [
      {
        "label": "A",
        "text": "Normal serum urea and creatinine levels",
        "correct": false
      },
      {
        "label": "B",
        "text": "Low uric acid levels",
        "correct": false
      },
      {
        "label": "C",
        "text": "Hypernatremia",
        "correct": true
      },
      {
        "label": "D",
        "text": "Normal blood pressure",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">SIADH does not cause hypernatremia. SIADH is the most common cause of euvolemic hyponatremia. The excess ADH secreted leads to the gain of water in the body. This stimulates baroreceptors to release atrial natriuretic peptide (ANP). ANP leads to the loss of water and salt in the urine, leading to urine sodium level of &amp;gt; 20 mEq/L in these patients. Thus, the level of water reaches a steady state (euvolemia) but the urinary loss of sodium continues to occur, giving rise to hyponatremia. SIADH is characterized by low levels of uric acid, normal blood pressure, and normal urea and creatinine levels. SIADH is diagnosed based on the following criteria (Bartter-Schwartz criteria): 1. Reduced serum osmolality 2. Urine osmolality &amp;gt; Serum osmolality 3. Clinical euvolemia 4. Increased levels of urinary sodium 5. Absence of other causes of hyponatremia like pituitary, renal, adrenal, thyroid or liver diseases.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "C. Hypernatremia"
  },
  {
    "id": 103,
    "text": "Q2. 66-year-old chronic smoker who was diagnosed with small cell carcinoma of the lung presents to the casualty with nausea, confusion, and dizziness. After the initial workup, he is diagnosed to have syndrome of inappropriate ADH secretion (SIADH). This condition is characterized by which of the following findings?",
    "options": [
      {
        "label": "A",
        "text": "Hyponatremia and urine sodium excretion &amp;gt; 20 mEq/L",
        "correct": true
      },
      {
        "label": "B",
        "text": "Hypernatremia and urine sodium excretion &amp;gt; 20 mEq/L",
        "correct": false
      },
      {
        "label": "C",
        "text": "Hyponatremia and urine sodium excretion &amp;lt; 20 mEq/L",
        "correct": false
      },
      {
        "label": "D",
        "text": "Hypernatremia and urine sodium excretion &amp;lt; 20 mEq/L",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The syndrome of inappropriate ADH secretion (SIADH) is associated with increased urinary excretion of sodium (urine sodium excretion &amp;gt; 20 mEq/L), and hyponatremia. Small cell lung cancer is commonly associated with SIADH due to the ectopic release of antidiuretic hormone.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "A. Hyponatremia and urine sodium excretion &amp;gt; 20 mEq/L"
  },
  {
    "id": 104,
    "text": "Q3. SIADH is not observed in which of the following conditions?",
    "options": [
      {
        "label": "A",
        "text": "Multiple sclerosis",
        "correct": false
      },
      {
        "label": "B",
        "text": "Oat cell carcinoma of lungs",
        "correct": false
      },
      {
        "label": "C",
        "text": "Acute attack of porphyria",
        "correct": false
      },
      {
        "label": "D",
        "text": "Primary pulmonary emphysema",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Primary pulmonary emphysema is not a cause of SIADH. Respiratory causes of SIADH include asthma, pneumothorax and positive-pressure respiration.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "D. Primary pulmonary emphysema"
  },
  {
    "id": 105,
    "text": "Q4. 92",
    "options": [
      {
        "label": "A",
        "text": "47-year-old woman presented with headache and nausea. Examination did not reveal any signs of dehydration and investigations revealed the findings shown below. Which of the following drugs does not lead to this condition? Demeclocycline",
        "correct": true
      },
      {
        "label": "B",
        "text": "Vincristine",
        "correct": false
      },
      {
        "label": "C",
        "text": "Carbamazepine",
        "correct": false
      },
      {
        "label": "D",
        "text": "Nicotine",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given scenario is suggestive of SIADH and demeclocycline does not cause this condition. Demeclocycline causes nephrogenic diabetes insipidus and hence is used in the treatment of chronic SIADH. The following features in the given case point towards the diagnosis of SIADH: ¬¢ Serum osmolality less than 275 mOsm/Kg * Urine osmolality more than 100 mOsm/Kg 95 * Urine sodium more than 20 mmol/L ¬¢ Serum sodium level less than 135 mmol/L</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "A. 47-year-old woman presented with headache and nausea. Examination did not reveal any signs of dehydration and investigations revealed the findings shown below. Which of the following drugs does not lead to this condition? Demeclocycline"
  },
  {
    "id": 106,
    "text": "Q5. Which of the following tumors is not associated with syndrome of inappropriate ADH secretion (SIADH)?",
    "options": [
      {
        "label": "A",
        "text": "Ewing‚Äôs sarcoma",
        "correct": false
      },
      {
        "label": "B",
        "text": "Thymoma",
        "correct": false
      },
      {
        "label": "C",
        "text": "Chromophobe adenoma",
        "correct": true
      },
      {
        "label": "D",
        "text": "Carcinoid",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Chromophobe adenoma is a type of pituitary adenoma that causes symptoms of hypogonadism due to pressure effects on the pituitary stalk. It is not a cause of syndrome of inappropriate ADH secretion (SIADH).</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "C. Chromophobe adenoma"
  },
  {
    "id": 107,
    "text": "Q6. child who underwent ventriculoperitoneal shunt surgery for tubercular meningitis with hydrocephalus, develops polyuria and hyponatremia. What could be the probable cause?",
    "options": [
      {
        "label": "A",
        "text": "Central diabetes insipidus",
        "correct": false
      },
      {
        "label": "B",
        "text": "SIADH",
        "correct": false
      },
      {
        "label": "C",
        "text": "Cerebral salt wasting",
        "correct": true
      },
      {
        "label": "D",
        "text": "Shunt block",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given scenario is suggestive of cerebral salt wasting. Both SIADH and cerebral salt wasting cause hyponatremia, but polyuria happens in cerebral salt wasting. Cerebral salt wasting results from hypersecretion of atrial natriuretic peptide. It is seen primarily with central nervous system disorders including brain tumors, head trauma, hydrocephalus, neurosurgery, cerebrovascular accidents, and brain death. It is associated with hyponatremia, polyuria and elevated urinary sodium excretion. Treatment is by restoring intravascular volume with sodium chloride and water. Clinical parameters to distinguish between SIADH, cerebral salt wasting, and central diabetes insipidus are: Urine output Normal or lo | High High WwW Intravascular volume statu. | Normal or hi | Low Low s gh</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "C. Cerebral salt wasting"
  },
  {
    "id": 108,
    "text": "Q7. patient who presented with acute confusion and vomiting was diagnosed to have SIADH. This condition can be best treated by which of the following methods?",
    "options": [
      {
        "label": "A",
        "text": "Infusion of hypertonic (3%) saline",
        "correct": true
      },
      {
        "label": "B",
        "text": "Infusion of hypotonic (0.45%) saline",
        "correct": false
      },
      {
        "label": "C",
        "text": "Infusion of normal (0.9%) saline",
        "correct": false
      },
      {
        "label": "D",
        "text": "Administration of DDAVP 93",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given scenario is suggestive of acute symptomatic SIADH and this condition is best treated by the infusion of hypertonic (3%) saline. This mode of treatment also helps in the correction of sodium deficiency that is partly responsible for hyponatremia. The other form of treatment is to help reduce the concentration of body water by giving an AVP receptor-2 antagonist, conivaptan. Conivaptan blocks the antidiuretic effect of AVP and increases urine output. 96 DDAVP is a synthetic analog of AVP and should not be used as it will further increase water retention.</div> ",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "A. Infusion of hypertonic (3%) saline"
  },
  {
    "id": 109,
    "text": "Q8. What is the drug of choice for the treatment of chronic SIADH?",
    "options": [
      {
        "label": "A",
        "text": "Furosemide",
        "correct": false
      },
      {
        "label": "B",
        "text": "Tolvaptan",
        "correct": true
      },
      {
        "label": "C",
        "text": "Demeclocycline",
        "correct": false
      },
      {
        "label": "D",
        "text": "Fludrocortisone",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The drug of choice for the treatment of chronic SIADH is tolvaptan. Vaptans are selective V2 receptor antagonists that act by increasing urinary water excretion by blocking the antidiuretic effect of AVP. Treatment options for chronic SIADH include: * Restriction of fluid intake to below the level of urine output - This is considered the mainstay of treatment. But it also has certain disadvantages as stated below, and hence adding on a drug like vaptan is necessary in most cases. * Tolvaptan * Demeclocycline ¬¢ Fludrocortisone Advantages of vaptans over fluid restriction: ¬¢ Fluid restriction is usually a burden to the patient, unreliable, impractical, and slow to work. * Increased thirst is a frequently observed characteristic of hyponatremia in SIADH, and is particularly difficult to suppress. Hence, water restriction in SIADH frequently leads to non-compliance in the long run.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "B. Tolvaptan"
  },
  {
    "id": 110,
    "text": "Q9. What causes central pontine myelinolysis?",
    "options": [
      {
        "label": "A",
        "text": "Hyponatremia ee ee ee ee ee Detailed Explanations 94",
        "correct": false
      },
      {
        "label": "B",
        "text": "Hypokalemia",
        "correct": false
      },
      {
        "label": "C",
        "text": "Rapid correction of hyponatremia",
        "correct": true
      },
      {
        "label": "D",
        "text": "Rapid correction of hypokalemia ee ee ee ee ee ee ee ee ee ee ee ee ee ee",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Rapid correction of hyponatremia may result in central pontine myelinolysis. Central pontine myelinolysis is an osmotic demyelination syndrome (ODS), wherein rapid correction of hyponatremia results in water being driven out of the cell which has adapted to a chronic state of hypotonicity, leading to damage to the myelin sheath of these cells. It is characterized by the acute onset of quadriparesis, ataxia, and abnormal extraocular movements. 97</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "07_Syndrome of Inappropriate Anti-Diuretic Hormone...",
    "deck_id": 1755954606569,
    "correctAnswer": "C. Rapid correction of hyponatremia"
  }
];
        let currentQuestion = 0;
        let answers = [];
        let correctCount = 0;
        let incorrectCount = 0;
        let answeredQuestions = new Set();
        let isTestMode = localStorage.getItem('testMode') === 'true' || false;

        console.log('Quiz loaded with', questions.length, 'questions');
        console.log('Test mode:', isTestMode);

        // Hide stats bar if test mode is enabled
        if (isTestMode) {
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('stats-bar').style.display = 'none';
            });
        }

        // Auto-start quiz
        startQuiz();

        function startQuiz() {
            answers = new Array(questions.length).fill(null);
            correctCount = 0;
            incorrectCount = 0;
            answeredQuestions = new Set();
            currentQuestion = 0;
            showQuestion(0);
            updateStats();
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            document.getElementById('question-number').textContent = `Question ${index + 1} of ${questions.length}`;
            document.getElementById('question-text').innerHTML = question.text;
            document.getElementById('question-status').textContent = answers[index] ? 'Question answered' : 'Click an option to answer';

            const imagesContainer = document.getElementById('question-images');
            imagesContainer.innerHTML = '';

            if (question.imageData) {
                const img = document.createElement('img');
                img.src = `data:${question.imageData.mime};base64,${question.imageData.data}`;
                img.className = 'medical-image';
                img.alt = 'Medical Question Image';
                imagesContainer.appendChild(img);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-card w-full p-6 text-left bg-white rounded-xl shadow-lg';
                button.innerHTML = `<span class="font-bold text-blue-600 mr-4">${option.label}.</span>${option.text}`;

                if (!isTestMode && answers[index] !== null) {
                    button.disabled = true;
                    if (option.correct) {
                        button.classList.add('correct');
                    } else if (answers[index] === option.label) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option.label);
                }

                if (answers[index] === option.label) {
                    button.classList.add('selected');
                }

                optionsContainer.appendChild(button);
            });

            // Show feedback only in normal mode and if answered
            if (!isTestMode && answers[index] !== null) {
                showFeedback(index);
            } else {
                document.getElementById('feedback-section').classList.add('hidden');
            }

            document.getElementById('prev-btn').disabled = index === 0;

            if (answers[index] !== null) {
                if (index === questions.length - 1) {
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('finish-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('finish-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');
            }

            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function selectAnswer(label) {
            const question = questions[currentQuestion];
            const correctOption = question.options.find(opt => opt.correct);
            const isCorrect = correctOption && label === correctOption.label;

            if (!answeredQuestions.has(currentQuestion)) {
                answeredQuestions.add(currentQuestion);
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }

            answers[currentQuestion] = label;
            updateStats();
            
            showQuestion(currentQuestion);
        }

        function showFeedback(questionIndex) {
            const question = questions[questionIndex];
            const userAnswer = answers[questionIndex];
            const correctOption = question.options.find(opt => opt.correct);
            const userOption = question.options.find(opt => opt.label === userAnswer);
            const isCorrect = correctOption && userAnswer === correctOption.label;

            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackMessage = document.getElementById('feedback-message');

            if (isCorrect) {
                feedbackSection.className = 'bg-green-50 border border-green-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚úÖ';
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-green-700';
            } else {
                feedbackSection.className = 'bg-red-50 border border-red-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚ùå';
                feedbackMessage.textContent = 'Incorrect';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-red-700';
            }

            document.getElementById('user-answer-display').innerHTML = `<span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Unknown'}</span>`;
            document.getElementById('correct-answer-display').textContent = question.correctAnswer;

            const explanationSection = document.getElementById('explanation-section');
            if (question.explanationHTML && question.explanationHTML.trim()) {
                document.getElementById('explanation-content').innerHTML = question.explanationHTML;
                explanationSection.classList.remove('hidden');
            } else {
                explanationSection.classList.add('hidden');
            }

            feedbackSection.classList.remove('hidden');
        }

        function updateStats() {
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);

            document.getElementById('correct-stats').textContent = correctCount;
            document.getElementById('incorrect-stats').textContent = incorrectCount;
            document.getElementById('accuracy-stats').textContent = `${accuracy}%`;
            document.getElementById('progress-stats').textContent = `${totalAnswered}/${questions.length}`;
        }

        document.getElementById('prev-btn').onclick = () => {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        };
        
        document.getElementById('finish-btn').onclick = showFinalResults;

        function showFinalResults() {
            if (isTestMode) {
                showTestModeResults();
            } else {
                showNormalModeResults();
            }
        }

        function showTestModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');

            document.getElementById('test-final-correct').textContent = correctCount;
            document.getElementById('test-final-incorrect').textContent = incorrectCount;
            document.getElementById('test-final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('test-grade-icon').textContent = gradeIcon;

            // Show detailed review
            const reviewContainer = document.getElementById('test-review-details');
            reviewContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = answers[index];
                const correctOption = question.options.find(opt => opt.correct);
                const userOption = question.options.find(opt => opt.label === userAnswer);
                const isCorrect = correctOption && userAnswer === correctOption.label;

                const reviewCard = document.createElement('div');
                reviewCard.className = `border-l-4 p-4 bg-white rounded-lg shadow-sm ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                reviewCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-800">Question ${index + 1}</h4>
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${question.text}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <strong class="text-gray-600">Your Answer:</strong><br>
                            <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Not answered'}</span>
                        </div>
                        <div>
                            <strong class="text-gray-600">Correct Answer:</strong><br>
                            <span class="text-green-600">${question.correctAnswer}</span>
                        </div>
                    </div>
                    ${question.explanationHTML ? `
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                            <strong class="text-blue-800">Explanation:</strong>
                            <div class="mt-2 explanation-content">${question.explanationHTML}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
        }

        function showNormalModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('final-results').classList.remove('hidden');

            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('final-grade-icon').textContent = gradeIcon;
        }
    </script>
</body>
</html>