<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03_General Principles of Endocrinology - Marrow Medicine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .medical-quiz {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .question-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        
        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }
        
        .option-card.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.3s;
        }
        
        .medical-image {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }
        
        .hidden {
            display: none !important;
        }

        .explanation-content {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.05rem;
            line-height: 1.7;
            color: #374151;
            text-align: left;
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .explanation-content strong, .explanation-content b {
            font-weight: 600;
            color: #1f2937;
        }
        
        .explanation-content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen medical-quiz">
    <header class="bg-white shadow-xl p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">03_General Principles of Endocrinology</h1>
                <p class="text-gray-600 mt-2">Marrow ‚Ä¢ Medicine ‚Ä¢ Interactive Learning</p>
            </div>
            <div class="flex gap-2">
                <button class="bg-gray-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-gray-600 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    ‚Üê Topics
                </button>
                <button class="bg-purple-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-purple-600 transition" 
                        onclick="window.location.href='marrow.html'">
                    üìö Marrow
                </button>
                <button class="bg-blue-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-blue-600 transition" 
                        onclick="window.location.href='index.html'">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar (Hidden in Test Mode) -->
    <div class="bg-white shadow-lg p-4" id="stats-bar">
        <div class="container mx-auto flex justify-center gap-8">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="correct-stats">0</div>
                <div class="text-sm text-gray-600">Correct</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="incorrect-stats">0</div>
                <div class="text-sm text-gray-600">Incorrect</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="accuracy-stats">0%</div>
                <div class="text-sm text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="progress-stats">0/13</div>
                <div class="text-sm text-gray-600">Progress</div>
            </div>
        </div>
    </div>

    <!-- Quiz Section -->
    <section class="container mx-auto p-6" id="quiz-section">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-8">
                <div class="progress-bar h-4 rounded-full" id="progress-bar"></div>
            </div>

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-blue-700" id="question-number">Question 1 of 13</h2>
                <div class="text-sm text-gray-600" id="question-status">Click an option to answer</div>
            </div>

            <!-- Question Text -->
            <div class="mb-10">
                <div class="question-card text-white p-8 rounded-2xl mb-8" id="question-text"></div>
                
                <!-- Question Image -->
                <div class="text-center mb-8" id="question-images"></div>
                
                <!-- Options -->
                <div class="space-y-4" id="options"></div>
            </div>

            <!-- Answer Feedback Section (Normal Mode Only) -->
            <div class="hidden mb-8 p-6 rounded-2xl" id="feedback-section">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2" id="feedback-icon"></div>
                    <div class="text-2xl font-bold mb-2" id="feedback-message">Correct!</div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Your Answer:</strong><br>
                        <span id="user-answer-display"></span>
                    </div>
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Correct Answer:</strong><br>
                        <span class="text-green-600" id="correct-answer-display"></span>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl" id="explanation-section">
                    <strong class="text-lg text-blue-800">Explanation:</strong>
                    <div id="explanation-content" class="mt-3 explanation-content"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between gap-4">
                <button class="bg-gray-400 text-white px-6 py-3 rounded-xl hover:bg-gray-500 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                
                <div class="flex gap-4">
                    <button class="bg-gray-400 text-white px-6 py-3 rounded-xl disabled" id="prev-btn">
                        Previous
                    </button>
                    <button class="bg-blue-500 text-white px-6 py-3 rounded-xl hidden" id="next-btn">
                        Next
                    </button>
                    <button class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hidden" id="finish-btn">
                        Finish Quiz
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="test-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Test Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="test-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="test-final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="test-final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="test-final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>

            <!-- Detailed Review -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed Review</h3>
                <div id="test-review-details" class="space-y-4"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <!-- Normal Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="final-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Quiz Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="final-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_medicine.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <script>
        const questions = [
  {
    "id": 45,
    "text": "Q1. Vasopressin acting on its V2 receptor uses as its second messenger.",
    "options": [
      {
        "label": "A",
        "text": "Calcium",
        "correct": false
      },
      {
        "label": "B",
        "text": "cGMP",
        "correct": false
      },
      {
        "label": "C",
        "text": "cAMP",
        "correct": true
      },
      {
        "label": "D",
        "text": "Phospholipase C",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Vasopressin acts on the V2 receptor using cAMP as its second messenger. Vasopressin acts on GPCR using different second messengers to accomplish its various actions as follows: * V1 receptor - vasoconstriction using phospholipase C as its second messenger * V2 receptor - reabsorption of water through aquaporin 2, using cAMP as its second messenger 53 Vasopressin has a maximum effect on the collecting ducts. It acts by inserting aquaporin 2 present in cytoplasmic vesicles of principal cells on to the apical membrane.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "C. cAMP"
  },
  {
    "id": 46,
    "text": "Q2. Which of the following act as the second messenger for secretin?",
    "options": [
      {
        "label": "A",
        "text": "cAMP",
        "correct": true
      },
      {
        "label": "B",
        "text": "cGMP",
        "correct": false
      },
      {
        "label": "C",
        "text": "Serine kinase",
        "correct": false
      },
      {
        "label": "D",
        "text": "Tyrosine kinase",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">cAMP is the second messenger for the hormone secretin. It regulates fluid and electrolyte secretion and also mediates water and nutrient reabsorption.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "A. cAMP"
  },
  {
    "id": 47,
    "text": "Q3. Which hormone mediates its action via cyclic GMP?",
    "options": [
      {
        "label": "A",
        "text": "Oxytocin",
        "correct": false
      },
      {
        "label": "B",
        "text": "Vasopressin",
        "correct": false
      },
      {
        "label": "C",
        "text": "Aldosterone",
        "correct": false
      },
      {
        "label": "D",
        "text": "Nitric oxide",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Nitric oxide mediates its action via cyclic GMP or cGMP. cGMP is the second messenger associated with smooth muscle relaxation and vasodilation. Atrial natriuretic factor (ANF) and NO (nitric oxide) are the only hormones that mediate their action via cGMP. Note: Recent studies show that NO is a hormone. NO, which functions as a chemical messenger, has similar properties to hormones (which are known as the body's chemical messengers).</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "D. Nitric oxide"
  },
  {
    "id": 48,
    "text": "Q4. What is the most abundant hormone produced by the pituitary gland?",
    "options": [
      {
        "label": "A",
        "text": "Vasopressin",
        "correct": false
      },
      {
        "label": "B",
        "text": "GH",
        "correct": true
      },
      {
        "label": "C",
        "text": "ACTH 50",
        "correct": false
      },
      {
        "label": "D",
        "text": "TSH",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Growth hormone (GH) is the most abundant hormone produced by the pituitary gland. It is produced by the acidophil cells or somatotropes of the anterior pituitary, which account for 50% of the anterior pituitary cell population. Option A: Vasopressin is produced in the hypothalamus and only stored in the posterior pituitary. Option C: Corticotrophs account for 10% of the anterior pituitary cell population. Option D: Thyrotrophs account for 5% of the anterior pituitary cell population.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "B. GH"
  },
  {
    "id": 49,
    "text": "Q5. Insulin acts on which of the following?",
    "options": [
      {
        "label": "A",
        "text": "Nuclear receptor",
        "correct": false
      },
      {
        "label": "B",
        "text": "Cytoplasmic receptor",
        "correct": false
      },
      {
        "label": "C",
        "text": "Tyrosine kinase receptor",
        "correct": true
      },
      {
        "label": "D",
        "text": "STK receptor",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Insulin acts on the tyrosine kinase receptor, a cell-surface receptor.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "C. Tyrosine kinase receptor"
  },
  {
    "id": 50,
    "text": "Q6. Which of the following is considered the twin hormone of prolactin?",
    "options": [
      {
        "label": "A",
        "text": "ACTH",
        "correct": false
      },
      {
        "label": "B",
        "text": "GH",
        "correct": true
      },
      {
        "label": "C",
        "text": "Oxytocin",
        "correct": false
      },
      {
        "label": "D",
        "text": "Dopamine",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">GH and prolactin are called twin hormones as both are secreted by the acidophil cells of the anterior pituitary. They act on cytokine receptors and show JAK-STAT activity. 54</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "B. GH"
  },
  {
    "id": 51,
    "text": "Q7. Which of the following hormones is an amino acid derivative?",
    "options": [
      {
        "label": "A",
        "text": "Thyroid hormone",
        "correct": true
      },
      {
        "label": "B",
        "text": "Insulin",
        "correct": false
      },
      {
        "label": "C",
        "text": "Activin",
        "correct": false
      },
      {
        "label": "D",
        "text": "Parathyroid hormone",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The thyroid hormone is synthesized from tyrosine residues and thus is an amino acid derivative. Insulin, activin and parathyroid hormone are large protein hormones.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "A. Thyroid hormone"
  },
  {
    "id": 52,
    "text": "Q8. Which of the following chemical molecules is not a steroid hormones?",
    "options": [
      {
        "label": "A",
        "text": "Cortisol",
        "correct": false
      },
      {
        "label": "B",
        "text": "Estrogen",
        "correct": false
      },
      {
        "label": "C",
        "text": "DHEA",
        "correct": false
      },
      {
        "label": "D",
        "text": "Inhibin 51",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Inhibin is a large protein hormone, not a steroid hormone. All adrenocortical and reproductive hormones are steroid hormones synthesized from cholesterol precursors except activin and inhibin.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "D. Inhibin 51"
  },
  {
    "id": 53,
    "text": "Q9. Which class of hormones does insulin belong to?",
    "options": [
      {
        "label": "A",
        "text": "Amino acid derivatives",
        "correct": false
      },
      {
        "label": "B",
        "text": "Small neuropeptides",
        "correct": false
      },
      {
        "label": "C",
        "text": "Large protein hormones",
        "correct": true
      },
      {
        "label": "D",
        "text": "Medium-sized peptide",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Insulin is classified as a large protein hormone (&amp;gt; 50 amino acid residues) as it is composed of 51 amino acids. Protein and polypeptide hormones are classified as small peptides (&amp;lt; 50 amino acid residues) and large proteins.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "C. Large protein hormones"
  },
  {
    "id": 54,
    "text": "Q10. The action of cAMP is mediated by",
    "options": [
      {
        "label": "A",
        "text": "Adenylyl cyclase",
        "correct": false
      },
      {
        "label": "B",
        "text": "Guanylyl cyclase",
        "correct": false
      },
      {
        "label": "C",
        "text": "Protein kinase",
        "correct": true
      },
      {
        "label": "D",
        "text": "IP3-DAG",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The action of cAMP is mediated by protein kinases. cAMP is a second messenger molecule associated with electrolyte secretion and water and nutrient reabsorption. It is synthesized by adenylyl cyclase but it mediates its actions via protein kinases.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "C. Protein kinase"
  },
  {
    "id": 55,
    "text": "Q11. The second messenger, cAMP is synthesized by the enzyme",
    "options": [
      {
        "label": "A",
        "text": "Adenylyl cyclase",
        "correct": true
      },
      {
        "label": "B",
        "text": "cAMP phosphodiesterase",
        "correct": false
      },
      {
        "label": "C",
        "text": "ATPase",
        "correct": false
      },
      {
        "label": "D",
        "text": "Phosphorylase",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">cAMP is synthesized by adenylyl cyclase, but it mediates its actions via protein kinases.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "A. Adenylyl cyclase"
  },
  {
    "id": 56,
    "text": "Q12. Which of the following is not activated by the binding of epinephrine to its receptor?",
    "options": [
      {
        "label": "A",
        "text": "Gi",
        "correct": false
      },
      {
        "label": "B",
        "text": "Gq",
        "correct": false
      },
      {
        "label": "C",
        "text": "Gp",
        "correct": true
      },
      {
        "label": "D",
        "text": "Gs 52",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The binding of epinephrine to its various receptors results in the activation of different types of G-protein subunits, namely Gq, Gi, and Gs. All catecholamines act via G protein-coupled receptors. This stimulates cAMP production and signaling via protein kinases. 55</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "C. Gp"
  },
  {
    "id": 57,
    "text": "Q13. The enzyme kinase adds to proteins.",
    "options": [
      {
        "label": "A",
        "text": "Acetates ee ee ee ee ee ee ee ee ee ee ee ee ee ee ee ee ee ee Detailed Explanations Solution to Question 1: Vasopressin acts on the V2 receptor using cAMP as its second messenger. Vasopressin acts on GPCR using different second messengers to accomplish its various actions as follows: * V1 receptor - vasoconstriction using phospholipase C as its second messenger * V2 receptor - reabsorption of water through aquaporin 2, using cAMP as its second messenger 53",
        "correct": false
      },
      {
        "label": "B",
        "text": "Sulphates",
        "correct": false
      },
      {
        "label": "C",
        "text": "Carbonates",
        "correct": false
      },
      {
        "label": "D",
        "text": "Phosphates",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Kinases are a subclass of transferases that catalyze the transfer of a phosphate group from a donor to an acceptor protein. They are associated with the regulation of many essential cellular processes. 56</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "03_General Principles of Endocrinology",
    "deck_id": 1755954606702,
    "correctAnswer": "D. Phosphates"
  }
];
        let currentQuestion = 0;
        let answers = [];
        let correctCount = 0;
        let incorrectCount = 0;
        let answeredQuestions = new Set();
        let isTestMode = localStorage.getItem('testMode') === 'true' || false;

        console.log('Quiz loaded with', questions.length, 'questions');
        console.log('Test mode:', isTestMode);

        // Hide stats bar if test mode is enabled
        if (isTestMode) {
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('stats-bar').style.display = 'none';
            });
        }

        // Auto-start quiz
        startQuiz();

        function startQuiz() {
            answers = new Array(questions.length).fill(null);
            correctCount = 0;
            incorrectCount = 0;
            answeredQuestions = new Set();
            currentQuestion = 0;
            showQuestion(0);
            updateStats();
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            document.getElementById('question-number').textContent = `Question ${index + 1} of ${questions.length}`;
            document.getElementById('question-text').innerHTML = question.text;
            document.getElementById('question-status').textContent = answers[index] ? 'Question answered' : 'Click an option to answer';

            const imagesContainer = document.getElementById('question-images');
            imagesContainer.innerHTML = '';

            if (question.imageData) {
                const img = document.createElement('img');
                img.src = `data:${question.imageData.mime};base64,${question.imageData.data}`;
                img.className = 'medical-image';
                img.alt = 'Medical Question Image';
                imagesContainer.appendChild(img);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-card w-full p-6 text-left bg-white rounded-xl shadow-lg';
                button.innerHTML = `<span class="font-bold text-blue-600 mr-4">${option.label}.</span>${option.text}`;

                if (!isTestMode && answers[index] !== null) {
                    button.disabled = true;
                    if (option.correct) {
                        button.classList.add('correct');
                    } else if (answers[index] === option.label) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option.label);
                }

                if (answers[index] === option.label) {
                    button.classList.add('selected');
                }

                optionsContainer.appendChild(button);
            });

            // Show feedback only in normal mode and if answered
            if (!isTestMode && answers[index] !== null) {
                showFeedback(index);
            } else {
                document.getElementById('feedback-section').classList.add('hidden');
            }

            document.getElementById('prev-btn').disabled = index === 0;

            if (answers[index] !== null) {
                if (index === questions.length - 1) {
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('finish-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('finish-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');
            }

            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function selectAnswer(label) {
            const question = questions[currentQuestion];
            const correctOption = question.options.find(opt => opt.correct);
            const isCorrect = correctOption && label === correctOption.label;

            if (!answeredQuestions.has(currentQuestion)) {
                answeredQuestions.add(currentQuestion);
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }

            answers[currentQuestion] = label;
            updateStats();
            
            showQuestion(currentQuestion);
        }

        function showFeedback(questionIndex) {
            const question = questions[questionIndex];
            const userAnswer = answers[questionIndex];
            const correctOption = question.options.find(opt => opt.correct);
            const userOption = question.options.find(opt => opt.label === userAnswer);
            const isCorrect = correctOption && userAnswer === correctOption.label;

            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackMessage = document.getElementById('feedback-message');

            if (isCorrect) {
                feedbackSection.className = 'bg-green-50 border border-green-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚úÖ';
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-green-700';
            } else {
                feedbackSection.className = 'bg-red-50 border border-red-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚ùå';
                feedbackMessage.textContent = 'Incorrect';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-red-700';
            }

            document.getElementById('user-answer-display').innerHTML = `<span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Unknown'}</span>`;
            document.getElementById('correct-answer-display').textContent = question.correctAnswer;

            const explanationSection = document.getElementById('explanation-section');
            if (question.explanationHTML && question.explanationHTML.trim()) {
                document.getElementById('explanation-content').innerHTML = question.explanationHTML;
                explanationSection.classList.remove('hidden');
            } else {
                explanationSection.classList.add('hidden');
            }

            feedbackSection.classList.remove('hidden');
        }

        function updateStats() {
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);

            document.getElementById('correct-stats').textContent = correctCount;
            document.getElementById('incorrect-stats').textContent = incorrectCount;
            document.getElementById('accuracy-stats').textContent = `${accuracy}%`;
            document.getElementById('progress-stats').textContent = `${totalAnswered}/${questions.length}`;
        }

        document.getElementById('prev-btn').onclick = () => {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        };
        
        document.getElementById('finish-btn').onclick = showFinalResults;

        function showFinalResults() {
            if (isTestMode) {
                showTestModeResults();
            } else {
                showNormalModeResults();
            }
        }

        function showTestModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');

            document.getElementById('test-final-correct').textContent = correctCount;
            document.getElementById('test-final-incorrect').textContent = incorrectCount;
            document.getElementById('test-final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('test-grade-icon').textContent = gradeIcon;

            // Show detailed review
            const reviewContainer = document.getElementById('test-review-details');
            reviewContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = answers[index];
                const correctOption = question.options.find(opt => opt.correct);
                const userOption = question.options.find(opt => opt.label === userAnswer);
                const isCorrect = correctOption && userAnswer === correctOption.label;

                const reviewCard = document.createElement('div');
                reviewCard.className = `border-l-4 p-4 bg-white rounded-lg shadow-sm ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                reviewCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-800">Question ${index + 1}</h4>
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${question.text}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <strong class="text-gray-600">Your Answer:</strong><br>
                            <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Not answered'}</span>
                        </div>
                        <div>
                            <strong class="text-gray-600">Correct Answer:</strong><br>
                            <span class="text-green-600">${question.correctAnswer}</span>
                        </div>
                    </div>
                    ${question.explanationHTML ? `
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                            <strong class="text-blue-800">Explanation:</strong>
                            <div class="mt-2 explanation-content">${question.explanationHTML}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
        }

        function showNormalModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('final-results').classList.remove('hidden');

            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('final-grade-icon').textContent = gradeIcon;
        }
    </script>
</body>
</html>