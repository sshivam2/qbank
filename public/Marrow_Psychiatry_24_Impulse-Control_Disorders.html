<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24_Impulse-Control Disorders - Marrow Psychiatry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .medical-quiz {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .question-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        
        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }
        
        .option-card.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.3s;
        }
        
        .medical-image {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }
        
        .hidden {
            display: none !important;
        }

        .explanation-content {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.05rem;
            line-height: 1.7;
            color: #374151;
            text-align: left;
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .explanation-content strong, .explanation-content b {
            font-weight: 600;
            color: #1f2937;
        }
        
        .explanation-content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen medical-quiz">
    <header class="bg-white shadow-xl p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">24_Impulse-Control Disorders</h1>
                <p class="text-gray-600 mt-2">Marrow ‚Ä¢ Psychiatry ‚Ä¢ Interactive Learning</p>
            </div>
            <div class="flex gap-2">
                <button class="bg-gray-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-gray-600 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    ‚Üê Topics
                </button>
                <button class="bg-purple-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-purple-600 transition" 
                        onclick="window.location.href='marrow.html'">
                    üìö Marrow
                </button>
                <button class="bg-blue-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-blue-600 transition" 
                        onclick="window.location.href='index.html'">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar (Hidden in Test Mode) -->
    <div class="bg-white shadow-lg p-4" id="stats-bar">
        <div class="container mx-auto flex justify-center gap-8">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="correct-stats">0</div>
                <div class="text-sm text-gray-600">Correct</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="incorrect-stats">0</div>
                <div class="text-sm text-gray-600">Incorrect</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="accuracy-stats">0%</div>
                <div class="text-sm text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="progress-stats">0/7</div>
                <div class="text-sm text-gray-600">Progress</div>
            </div>
        </div>
    </div>

    <!-- Quiz Section -->
    <section class="container mx-auto p-6" id="quiz-section">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-8">
                <div class="progress-bar h-4 rounded-full" id="progress-bar"></div>
            </div>

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-blue-700" id="question-number">Question 1 of 7</h2>
                <div class="text-sm text-gray-600" id="question-status">Click an option to answer</div>
            </div>

            <!-- Question Text -->
            <div class="mb-10">
                <div class="question-card text-white p-8 rounded-2xl mb-8" id="question-text"></div>
                
                <!-- Question Image -->
                <div class="text-center mb-8" id="question-images"></div>
                
                <!-- Options -->
                <div class="space-y-4" id="options"></div>
            </div>

            <!-- Answer Feedback Section (Normal Mode Only) -->
            <div class="hidden mb-8 p-6 rounded-2xl" id="feedback-section">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2" id="feedback-icon"></div>
                    <div class="text-2xl font-bold mb-2" id="feedback-message">Correct!</div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Your Answer:</strong><br>
                        <span id="user-answer-display"></span>
                    </div>
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Correct Answer:</strong><br>
                        <span class="text-green-600" id="correct-answer-display"></span>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl" id="explanation-section">
                    <strong class="text-lg text-blue-800">Explanation:</strong>
                    <div id="explanation-content" class="mt-3 explanation-content"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between gap-4">
                <button class="bg-gray-400 text-white px-6 py-3 rounded-xl hover:bg-gray-500 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                
                <div class="flex gap-4">
                    <button class="bg-gray-400 text-white px-6 py-3 rounded-xl disabled" id="prev-btn">
                        Previous
                    </button>
                    <button class="bg-blue-500 text-white px-6 py-3 rounded-xl hidden" id="next-btn">
                        Next
                    </button>
                    <button class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hidden" id="finish-btn">
                        Finish Quiz
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="test-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Test Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="test-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="test-final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="test-final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="test-final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>

            <!-- Detailed Review -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed Review</h3>
                <div id="test-review-details" class="space-y-4"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <!-- Normal Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="final-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Quiz Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="final-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <script>
        const questions = [
  {
    "id": 339,
    "text": "Q1. Which of the following is not classified under impulse control disorder?",
    "options": [
      {
        "label": "A",
        "text": "Intermittent explosive disorder",
        "correct": false
      },
      {
        "label": "B",
        "text": "Pyromania",
        "correct": false
      },
      {
        "label": "C",
        "text": "Trichotillomania",
        "correct": true
      },
      {
        "label": "D",
        "text": "Kleptomania",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Trichotillomania is classified under obsessive-compulsive and related disorders, not under impulse-control disorders. It refers to compulsive hair pulling. Disruptive, impulse-control, and conduct disorders are classified together in DSM5. The disorders included are: * Intermittent explosive disorder * Kleptomania * Pyromania * Conduct disorder * Oppositional defiant disorder</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "C. Trichotillomania"
  },
  {
    "id": 340,
    "text": "Q2. Which of the following is not a typical feature seen in a patient with an impulse control disorder?",
    "options": [
      {
        "label": "A",
        "text": "Does not feel remorse about the act",
        "correct": true
      },
      {
        "label": "B",
        "text": "Gratification after completing the act",
        "correct": false
      },
      {
        "label": "C",
        "text": "Intense drive to perform a particular act",
        "correct": false
      },
      {
        "label": "D",
        "text": "Experiences mounting tension and arousal before the act",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Patients with impulse control disorders feel remorse and guilt about the act. Impulse control disorders are characterized by the inability to resist an intense impulse, drive, or temptation to perform a particular act that is harmful to self or others, or both. Before the event, the individual usually experiences mounting tension and arousal, sometimes mingled with conscious anticipatory pleasure. Completing the action brings immediate gratification and relief. Afterward, the individual experiences remorse and guilt. 287</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "A. Does not feel remorse about the act"
  },
  {
    "id": 341,
    "text": "Q3. 21-year-old boy is brought by his mother to the OPD. She complains that the boy recently tried to light a fire in their garage. He explains that he has a great fascination with fire and experiences pleasure while doing so. He was also involved in multiple fire episodes in his neighbourhood. Which substance abuse is most commonly associated with his condition?",
    "options": [
      {
        "label": "A",
        "text": "Cannabis",
        "correct": false
      },
      {
        "label": "B",
        "text": "Alcohol",
        "correct": true
      },
      {
        "label": "C",
        "text": "Heroine",
        "correct": false
      },
      {
        "label": "D",
        "text": "Cocaine",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The patient's history is suggestive of pyromania. The substance abuse most commonly associated with pyromania is alcohol. Pyromania is the deliberate setting of fires on more than one occasion. Pyromania is significantly associated with the following: ¬¢ Substance abuse disorder (especially alcoholism) * Affective disorders (depression or bipolar disorder) * Other impulse control disorders, such as kleptomania in female firesetters * Personality disturbances, such as borderline personality disorders ¬¢ Attention-deficit/hyperactivity disorder and learning disabilities in childhood pyromania</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "B. Alcohol"
  },
  {
    "id": 342,
    "text": "Q4. 285",
    "options": [
      {
        "label": "A",
        "text": "school girl is brought to the OPD by her worried mother with complaints of an urge to steal her classmate&apos;s pens and a feeling of gratification after doing so. The school headmistress says she was caught stealing one and was found with a bag full of pens. She is otherwise a good student and performs well. Which of the following is true about this condition? Stealing is planned beforehand",
        "correct": false
      },
      {
        "label": "B",
        "text": "Stealing is not for personal gain",
        "correct": true
      },
      {
        "label": "C",
        "text": "Stealing can be explained by a conduct disorder",
        "correct": false
      },
      {
        "label": "D",
        "text": "Stealing is done for vengeance",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given clinical scenario is suggestive of kleptomania. It is characterized by recurrent impulses to steal objects not needed for personal use or for monetary value. DSM-5 criteria for kleptomania: * Recurrent failure to resist impulses to steal objects that are not needed for personal use or for their monetary value * Increasing sense of tension immediately before committing the theft * Pleasure, gratification, or relief at the time of committing the theft * The stealing is not committed to express anger or vengeance and is not in response to a delusion or a hallucination * The stealing is not explained by conduct disorder, a manic episode, or antisocial personality disorder</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "B. Stealing is not for personal gain"
  },
  {
    "id": 343,
    "text": "Q5. What is oniomania?",
    "options": [
      {
        "label": "A",
        "text": "Compulsive eating of onions",
        "correct": false
      },
      {
        "label": "B",
        "text": "Compulsive act of masturbation",
        "correct": false
      },
      {
        "label": "C",
        "text": "Compulsive drinking of alcohol",
        "correct": false
      },
      {
        "label": "D",
        "text": "Compulsive act of buying",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Oniomania refers to compulsive buying disorder. Persons with compulsive buying disorder are preoccupied with shopping and spending and devote significant time to these behaviors. Onanism is the other name for masturbation. Dipsomania refers to compulsive drinking of alcohol. 288</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "D. Compulsive act of buying"
  },
  {
    "id": 344,
    "text": "Q6. Which of the following features will be seen in a patient with intermittent explosive disorder?",
    "options": [
      {
        "label": "A",
        "text": "Single episode of losing control of aggressive impulses",
        "correct": false
      },
      {
        "label": "B",
        "text": "Remain generally angry between episodes",
        "correct": false
      },
      {
        "label": "C",
        "text": "Symptoms can develop within minutes to hours",
        "correct": true
      },
      {
        "label": "D",
        "text": "Amnesia for the episode after the episode is over",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Intermittent explosive disorder manifests as discrete episodes of losing control of aggressive impulses. The symptoms, which patients may describe as spells or attacks, appear within minutes or hours and, regardless of duration, remit spontaneously and quickly. One discrete episode does not justify the diagnosis. A minimum age of 6 years is required to diagnose this condition and it is more commonly seen in men than women. These episodes can result in serious assault or the destruction of property. The aggressiveness expressed is grossly out of proportion to any stressors that may have helped elicit the episodes. After each episode, patients usually show genuine regret or self-reproach. Signs of generalized impulsivity or aggressiveness are absent between episodes.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "C. Symptoms can develop within minutes to hours"
  },
  {
    "id": 345,
    "text": "Q7. woman complains to HR about her boss&apos;s attitude. She says whenever he is angry, he bangs the table and starts throwing things around. Later he apologizes for his behavior. He was asked to undergo psychiatric evaluation and was diagnosed with intermittent explosive disorder. Which of the following neurotransmitters plays a major role in this condition?",
    "options": [
      {
        "label": "A",
        "text": "Dopamine ee ee ee re ee ee ee ee ee ee ee es ee ee Detailed Explanations Solution to Question 1: Trichotillomania is classified under obsessive-compulsive and related disorders, not under impulse-control disorders. It refers to compulsive hair pulling. Disruptive, impulse-control, and conduct disorders are classified together in DSM5. The disorders included are: * Intermittent explosive disorder * Kleptomania * Pyromania * Conduct disorder * Oppositional defiant disorder Solution to Question 2: Patients with impulse control disorders feel remorse and guilt about the act. Impulse control disorders are characterized by the inability to resist an intense impulse, drive, or temptation to perform a particular act that is harmful to self or others, or both. Before the event, the individual usually experiences mounting tension and arousal, sometimes mingled with conscious anticipatory pleasure. Completing the action brings immediate gratification and relief. Afterward, the individual experiences remorse and guilt. 287",
        "correct": false
      },
      {
        "label": "B",
        "text": "Serotonin",
        "correct": true
      },
      {
        "label": "C",
        "text": "Histamine 286",
        "correct": false
      },
      {
        "label": "D",
        "text": "Gamma amino butyric acid",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Serotonin is believed to be the neurotransmitter that plays a major role in intermittent explosive disorder. Serotonergic neurons mediate behavioral inhibition. The restoration of serotonin activity, by administering serotonin precursors such as L-tryptophan or drugs that increase synaptic serotonin levels, restores the behavioral effect of punishment and controls episodic violent tendencies. Note: Low CSF 5-HIAA (hydroxy-indoleacetic acid) levels have been correlated with impulsive aggression. 289</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "24_Impulse-Control Disorders",
    "deck_id": 1755954606503,
    "correctAnswer": "B. Serotonin"
  }
];
        let currentQuestion = 0;
        let answers = [];
        let correctCount = 0;
        let incorrectCount = 0;
        let answeredQuestions = new Set();
        let isTestMode = localStorage.getItem('testMode') === 'true' || false;

        console.log('Quiz loaded with', questions.length, 'questions');
        console.log('Test mode:', isTestMode);

        // Hide stats bar if test mode is enabled
        if (isTestMode) {
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('stats-bar').style.display = 'none';
            });
        }

        // Auto-start quiz
        startQuiz();

        function startQuiz() {
            answers = new Array(questions.length).fill(null);
            correctCount = 0;
            incorrectCount = 0;
            answeredQuestions = new Set();
            currentQuestion = 0;
            showQuestion(0);
            updateStats();
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            document.getElementById('question-number').textContent = `Question ${index + 1} of ${questions.length}`;
            document.getElementById('question-text').innerHTML = question.text;
            document.getElementById('question-status').textContent = answers[index] ? 'Question answered' : 'Click an option to answer';

            const imagesContainer = document.getElementById('question-images');
            imagesContainer.innerHTML = '';

            if (question.imageData) {
                const img = document.createElement('img');
                img.src = `data:${question.imageData.mime};base64,${question.imageData.data}`;
                img.className = 'medical-image';
                img.alt = 'Medical Question Image';
                imagesContainer.appendChild(img);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-card w-full p-6 text-left bg-white rounded-xl shadow-lg';
                button.innerHTML = `<span class="font-bold text-blue-600 mr-4">${option.label}.</span>${option.text}`;

                if (!isTestMode && answers[index] !== null) {
                    button.disabled = true;
                    if (option.correct) {
                        button.classList.add('correct');
                    } else if (answers[index] === option.label) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option.label);
                }

                if (answers[index] === option.label) {
                    button.classList.add('selected');
                }

                optionsContainer.appendChild(button);
            });

            // Show feedback only in normal mode and if answered
            if (!isTestMode && answers[index] !== null) {
                showFeedback(index);
            } else {
                document.getElementById('feedback-section').classList.add('hidden');
            }

            document.getElementById('prev-btn').disabled = index === 0;

            if (answers[index] !== null) {
                if (index === questions.length - 1) {
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('finish-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('finish-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');
            }

            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function selectAnswer(label) {
            const question = questions[currentQuestion];
            const correctOption = question.options.find(opt => opt.correct);
            const isCorrect = correctOption && label === correctOption.label;

            if (!answeredQuestions.has(currentQuestion)) {
                answeredQuestions.add(currentQuestion);
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }

            answers[currentQuestion] = label;
            updateStats();
            
            showQuestion(currentQuestion);
        }

        function showFeedback(questionIndex) {
            const question = questions[questionIndex];
            const userAnswer = answers[questionIndex];
            const correctOption = question.options.find(opt => opt.correct);
            const userOption = question.options.find(opt => opt.label === userAnswer);
            const isCorrect = correctOption && userAnswer === correctOption.label;

            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackMessage = document.getElementById('feedback-message');

            if (isCorrect) {
                feedbackSection.className = 'bg-green-50 border border-green-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚úÖ';
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-green-700';
            } else {
                feedbackSection.className = 'bg-red-50 border border-red-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚ùå';
                feedbackMessage.textContent = 'Incorrect';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-red-700';
            }

            document.getElementById('user-answer-display').innerHTML = `<span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Unknown'}</span>`;
            document.getElementById('correct-answer-display').textContent = question.correctAnswer;

            const explanationSection = document.getElementById('explanation-section');
            if (question.explanationHTML && question.explanationHTML.trim()) {
                document.getElementById('explanation-content').innerHTML = question.explanationHTML;
                explanationSection.classList.remove('hidden');
            } else {
                explanationSection.classList.add('hidden');
            }

            feedbackSection.classList.remove('hidden');
        }

        function updateStats() {
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);

            document.getElementById('correct-stats').textContent = correctCount;
            document.getElementById('incorrect-stats').textContent = incorrectCount;
            document.getElementById('accuracy-stats').textContent = `${accuracy}%`;
            document.getElementById('progress-stats').textContent = `${totalAnswered}/${questions.length}`;
        }

        document.getElementById('prev-btn').onclick = () => {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        };
        
        document.getElementById('finish-btn').onclick = showFinalResults;

        function showFinalResults() {
            if (isTestMode) {
                showTestModeResults();
            } else {
                showNormalModeResults();
            }
        }

        function showTestModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');

            document.getElementById('test-final-correct').textContent = correctCount;
            document.getElementById('test-final-incorrect').textContent = incorrectCount;
            document.getElementById('test-final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('test-grade-icon').textContent = gradeIcon;

            // Show detailed review
            const reviewContainer = document.getElementById('test-review-details');
            reviewContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = answers[index];
                const correctOption = question.options.find(opt => opt.correct);
                const userOption = question.options.find(opt => opt.label === userAnswer);
                const isCorrect = correctOption && userAnswer === correctOption.label;

                const reviewCard = document.createElement('div');
                reviewCard.className = `border-l-4 p-4 bg-white rounded-lg shadow-sm ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                reviewCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-800">Question ${index + 1}</h4>
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${question.text}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <strong class="text-gray-600">Your Answer:</strong><br>
                            <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Not answered'}</span>
                        </div>
                        <div>
                            <strong class="text-gray-600">Correct Answer:</strong><br>
                            <span class="text-green-600">${question.correctAnswer}</span>
                        </div>
                    </div>
                    ${question.explanationHTML ? `
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                            <strong class="text-blue-800">Explanation:</strong>
                            <div class="mt-2 explanation-content">${question.explanationHTML}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
        }

        function showNormalModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('final-results').classList.remove('hidden');

            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('final-grade-icon').textContent = gradeIcon;
        }
    </script>
</body>
</html>