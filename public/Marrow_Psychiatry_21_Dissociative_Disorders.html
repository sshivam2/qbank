<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21_Dissociative Disorders - Marrow Psychiatry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .medical-quiz {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .question-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        
        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }
        
        .option-card.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.3s;
        }
        
        .medical-image {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }
        
        .hidden {
            display: none !important;
        }

        .explanation-content {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.05rem;
            line-height: 1.7;
            color: #374151;
            text-align: left;
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .explanation-content strong, .explanation-content b {
            font-weight: 600;
            color: #1f2937;
        }
        
        .explanation-content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen medical-quiz">
    <header class="bg-white shadow-xl p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">21_Dissociative Disorders</h1>
                <p class="text-gray-600 mt-2">Marrow ‚Ä¢ Psychiatry ‚Ä¢ Interactive Learning</p>
            </div>
            <div class="flex gap-2">
                <button class="bg-gray-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-gray-600 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    ‚Üê Topics
                </button>
                <button class="bg-purple-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-purple-600 transition" 
                        onclick="window.location.href='marrow.html'">
                    üìö Marrow
                </button>
                <button class="bg-blue-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-blue-600 transition" 
                        onclick="window.location.href='index.html'">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar (Hidden in Test Mode) -->
    <div class="bg-white shadow-lg p-4" id="stats-bar">
        <div class="container mx-auto flex justify-center gap-8">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="correct-stats">0</div>
                <div class="text-sm text-gray-600">Correct</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="incorrect-stats">0</div>
                <div class="text-sm text-gray-600">Incorrect</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="accuracy-stats">0%</div>
                <div class="text-sm text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="progress-stats">0/10</div>
                <div class="text-sm text-gray-600">Progress</div>
            </div>
        </div>
    </div>

    <!-- Quiz Section -->
    <section class="container mx-auto p-6" id="quiz-section">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-8">
                <div class="progress-bar h-4 rounded-full" id="progress-bar"></div>
            </div>

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-blue-700" id="question-number">Question 1 of 10</h2>
                <div class="text-sm text-gray-600" id="question-status">Click an option to answer</div>
            </div>

            <!-- Question Text -->
            <div class="mb-10">
                <div class="question-card text-white p-8 rounded-2xl mb-8" id="question-text"></div>
                
                <!-- Question Image -->
                <div class="text-center mb-8" id="question-images"></div>
                
                <!-- Options -->
                <div class="space-y-4" id="options"></div>
            </div>

            <!-- Answer Feedback Section (Normal Mode Only) -->
            <div class="hidden mb-8 p-6 rounded-2xl" id="feedback-section">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2" id="feedback-icon"></div>
                    <div class="text-2xl font-bold mb-2" id="feedback-message">Correct!</div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Your Answer:</strong><br>
                        <span id="user-answer-display"></span>
                    </div>
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Correct Answer:</strong><br>
                        <span class="text-green-600" id="correct-answer-display"></span>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl" id="explanation-section">
                    <strong class="text-lg text-blue-800">Explanation:</strong>
                    <div id="explanation-content" class="mt-3 explanation-content"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between gap-4">
                <button class="bg-gray-400 text-white px-6 py-3 rounded-xl hover:bg-gray-500 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                
                <div class="flex gap-4">
                    <button class="bg-gray-400 text-white px-6 py-3 rounded-xl disabled" id="prev-btn">
                        Previous
                    </button>
                    <button class="bg-blue-500 text-white px-6 py-3 rounded-xl hidden" id="next-btn">
                        Next
                    </button>
                    <button class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hidden" id="finish-btn">
                        Finish Quiz
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="test-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Test Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="test-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="test-final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="test-final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="test-final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>

            <!-- Detailed Review -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed Review</h3>
                <div id="test-review-details" class="space-y-4"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <!-- Normal Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="final-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Quiz Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="final-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <script>
        const questions = [
  {
    "id": 297,
    "text": "Q1. As per DSM-5, which of the following is not classified under dissociative disorders?",
    "options": [
      {
        "label": "A",
        "text": "Multiple identity disorder",
        "correct": false
      },
      {
        "label": "B",
        "text": "Conversion disorder",
        "correct": true
      },
      {
        "label": "C",
        "text": "Derealization disorder",
        "correct": false
      },
      {
        "label": "D",
        "text": "Depersonalisation disorder",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">As per DSM-5, conversion disorder (functional neurological symptom disorder) is classified under somatic symptom and related disorders, and not under dissociative disorders. DSM-5 classification of dissociative disorders includes the following: * Dissociative identity disorder (multiple identity disorder) * Dissociative amnesia * Depersonalization/derealization disorder * Other specified dissociative disorder * Unspecified dissociative disorder Note: Following psychological trauma, conversion disorder produces sensorimotor symptoms whereas dissociative disorders produce cognitive symptoms.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "B. Conversion disorder"
  },
  {
    "id": 298,
    "text": "Q2. Which of the following statements is false about dissociative disorders?",
    "options": [
      {
        "label": "A",
        "text": "Often preceded by psychological trauma",
        "correct": false
      },
      {
        "label": "B",
        "text": "Involves a conscious defence mechanism",
        "correct": true
      },
      {
        "label": "C",
        "text": "Associated with disruption of neurocognitive functions",
        "correct": false
      },
      {
        "label": "D",
        "text": "Experienced as inability to access information that normally is readily accessible",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Dissociation, which is an unconscious defense mechanism is the underlying mechanism in all dissociative disorders. Dissociative disorders result from the disruption of cognitive functions due to psychological trauma. They can be experienced as an inability to access information or to control mental functions that normally are readily amenable to access or control. 251</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "B. Involves a conscious defence mechanism"
  },
  {
    "id": 299,
    "text": "Q3. Which of the following is a negative dissociation symptom?",
    "options": [
      {
        "label": "A",
        "text": "Amnesia",
        "correct": true
      },
      {
        "label": "B",
        "text": "Fragmentation of identity",
        "correct": false
      },
      {
        "label": "C",
        "text": "Depersonalization",
        "correct": false
      },
      {
        "label": "D",
        "text": "Derealization",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Amnesia is a negative dissociation symptom. Positive dissociation symptoms are involuntary intrusions into awareness and behavior, with loss of continuity in subjective experience. E. g. , fragmentation of identity, depersonalization, and derealization. Negative dissociation symptoms are the inability to access information or to control mental functions that normally can be readily accessed or controlled. E. g. , amnesia.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "A. Amnesia"
  },
  {
    "id": 300,
    "text": "Q4. woman brings her husband to the psychiatry OPD. She says he is usually shy and mature. The previous week, she saw him flirting with a girl. When confronted, he said he could not recall this at all. During the fight, he suddenly started talking in a child-like voice and began to cry. What is the most likely diagnosis?",
    "options": [
      {
        "label": "A",
        "text": "Dissociative fugue 248",
        "correct": false
      },
      {
        "label": "B",
        "text": "Bipolar disorder",
        "correct": false
      },
      {
        "label": "C",
        "text": "Dissociative identity disorder",
        "correct": true
      },
      {
        "label": "D",
        "text": "Depersonalization",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given clinical scenario is suggestive of dissociative identity disorder. It is characterized by the presence of two or more distinct identities or personality states. It was previously called multiple personality disorder. The identities or personality states are called alters, self states, or alter identities. Each has its own pattern of perceiving and thinking about the environment and self. It is strongly associated with severe experiences of early childhood trauma, usually maltreatment.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "C. Dissociative identity disorder"
  },
  {
    "id": 301,
    "text": "Q5. man was brought to the ER with severe chest pain which was proven to be due to myocardial infarction. After recovery, however, he couldn&apos;t remember his 3-year-old son but could recognize his wife who he married 4 years ago. He said he works as a software engineer but his wife reported that he quit his job 6 months ago. Interestingly, he is still able to play the violin which he learnt last year. What is the most likely diagnosis?",
    "options": [
      {
        "label": "A",
        "text": "Anterograde amnesia",
        "correct": true
      },
      {
        "label": "B",
        "text": "Localized amnesia Cc) Selective amnesia",
        "correct": false
      },
      {
        "label": "C",
        "text": "Systematized amnesia",
        "correct": false
      },
      {
        "label": "D",
        "text": "",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The patient has features of dissociative amnesia. This patient's ability to remember some, but not all, of the events occurring during a circumscribed period of time, is known as selective amnesia. Dissociative amnesia is defined as an inability to recall important autobiographical information that is successfully stored in memory and ordinarily would be readily remembered. It is potentially reversible (unlike amnesias due to neuro-biological damage). It is further categorized into the following types: * Selective amnesia - ability to remember some, but not all, of the events occurring during a circumscribed period of time. * Localized amnesia - inability to recall all events related to a circumscribed period of time. * Generalized amnesia - failure to recall one‚Äôs entire life. * Continuous amnesia - failure to recall successive events as they occur. ¬¢ Systematized amnesia - amnesia for certain categories of memory, such as all memories relating to one‚Äôs family or a particular person.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "A. Anterograde amnesia"
  },
  {
    "id": 302,
    "text": "Q6. 52-year-old man is brought to the emergency department after being found in a confused state at the interstate bus station in Kerala. He is unable to recall his name, address, or any other personal information. His driving license from his wallet revealed that he is from Bangalore and that his wife had reported him missing 2 days ago. She says that he got laid off from his job, after which he did not come home. Which of the following is the most likely diagnosis for this patient&apos;s condition?",
    "options": [
      {
        "label": "A",
        "text": "Dissociative Amnesia",
        "correct": false
      },
      {
        "label": "B",
        "text": "Dissociative Fugue",
        "correct": true
      },
      {
        "label": "C",
        "text": "Dissociative Identity Disorder",
        "correct": false
      },
      {
        "label": "D",
        "text": "Depersonalization Disorder",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">History of sudden amnesia and wandering to the new place is suggestive of dissociative fugue. The onset of dissociative fuge is usually sudden, often in the presence of severe stress. The termination also is abrupt and is followed by amnesia for the episode, but with the recovery of 252 memories of earlier life.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "B. Dissociative Fugue"
  },
  {
    "id": 303,
    "text": "Q7. During the evaluation of a patient, a temporary loss of the sense of personal identity without the replacement by an alternate identity is noted. What is the most likely cause of this patient&apos;s condition?",
    "options": [
      {
        "label": "A",
        "text": "Dissociative trance disorder 249",
        "correct": true
      },
      {
        "label": "B",
        "text": "Dissociative identity disorder",
        "correct": false
      },
      {
        "label": "C",
        "text": "Dissociative fugue",
        "correct": false
      },
      {
        "label": "D",
        "text": "Dissociative amnesia",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given clinical scenario is suggestive of dissociative trance disorder. It manifests by a temporary, marked alteration in the state of consciousness or by loss of the customary sense of personal identity without the replacement by an alternate sense of identity. This condition is characterized by the following: ¬¢ Acute narrowing or complete loss of awareness of immediate surroundings ¬¢ Profound unresponsiveness or insensitivity to environmental stimuli * May be accompanied by minor stereotyped behaviors (e. g. , finger movements) of which the individual is unaware * Transient paralysis or loss of consciousness Possession trance is a variant of dissociative trance. It involves single or episodic alternations in the state of consciousness, characterized by the exchange of the person's customary identity with a new identity usually attributed to a spirit, divine power, deity, or another person. In this possessed state, the individual exhibits stereotypical and culturally determined behaviors or experiences being controlled by the possessing entity. There is always partial or full amnesia for the event.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "A. Dissociative trance disorder 249"
  },
  {
    "id": 304,
    "text": "Q8. 27-year-old woman complained that she was feeling detached from herself. She reported that she felt unreal, empty, and perceived she was watching herself in a movie. Her family says she was raped recently and has not been herself ever since. Which of the following best describes her perception?",
    "options": [
      {
        "label": "A",
        "text": "Derealization",
        "correct": false
      },
      {
        "label": "B",
        "text": "Dissociative fugue",
        "correct": false
      },
      {
        "label": "C",
        "text": "Dissociative amnesia",
        "correct": false
      },
      {
        "label": "D",
        "text": "Depersonalization",
        "correct": true
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given scenario is suggestive of depersonalization. It is defined as the persistent or recurrent feeling of detachment or estrangement from one's self. The individual may report feeling like watching himself or herself in a movie or feeling like an automaton. Experiences of unreality, detachment, or being an outside observer with respect to one's thoughts, feelings, sensations, body, or actions (e. g. , perceptual alterations, distorted sense of time, unreal or absent self, emotional and physical numbing). Derealization refers to feelings of unreality or of being detached from one's environment. The patient may describe his or her perception of the outside world as lacking lucidity and emotional coloring, as though dreaming or dead.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "D. Depersonalization"
  },
  {
    "id": 305,
    "text": "Q9. Which of the following conditions are associated with wandering?",
    "options": [
      {
        "label": "A",
        "text": "1,2and4 b)1and5",
        "correct": false
      },
      {
        "label": "B",
        "text": "2,3 and 4",
        "correct": false
      },
      {
        "label": "C",
        "text": "3, 4 and 5",
        "correct": true
      },
      {
        "label": "D",
        "text": "",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Wandering is travel away from the individual's home or customary place of daily activities and it can be seen in complex partial seizures, mania and dissociative identity disorder. Wandering is seen in the following neuropsychiatric conditions: 253 * Dissociative fugue - there is purposeful wandering, usually with the individual preoccupied with a single idea that is accompanied by a wish to run away * Dissociative amnesia * Dissociative personality disorder * Focal onset impaired awareness seizure (complex partial seizures) - exhibit wandering or semi purposeful behavior, or both, during seizures or in postictal states, for which subsequent amnesia occurs * Manic phase of bipolar disorder or schizoaffective disorder * Schizophrenia ¬¢ Malingering</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "C. 3, 4 and 5"
  },
  {
    "id": 306,
    "text": "Q10. Hysterical pseudodementia isatypeof_‚Äî_‚Äî?",
    "options": [
      {
        "label": "A",
        "text": "Dementia",
        "correct": false
      },
      {
        "label": "B",
        "text": "Malingering",
        "correct": false
      },
      {
        "label": "C",
        "text": "Dissociative disorder",
        "correct": true
      },
      {
        "label": "D",
        "text": "Personality disorder Answer Key 250",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Ganser syndrome (hysterical pseudodementia) is a type of dissociative disorder. It is commonly found in prison inmates. The characteristic feature is vorbeireden, which is also called approximate answers. The answers are incorrect but show that the person understands the nature of the question asked. E. g. , when asked about the color of an apple, the patient's answer is blue. 254</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "21_Dissociative Disorders",
    "deck_id": 1755954606524,
    "correctAnswer": "C. Dissociative disorder"
  }
];
        let currentQuestion = 0;
        let answers = [];
        let correctCount = 0;
        let incorrectCount = 0;
        let answeredQuestions = new Set();
        let isTestMode = localStorage.getItem('testMode') === 'true' || false;

        console.log('Quiz loaded with', questions.length, 'questions');
        console.log('Test mode:', isTestMode);

        // Hide stats bar if test mode is enabled
        if (isTestMode) {
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('stats-bar').style.display = 'none';
            });
        }

        // Auto-start quiz
        startQuiz();

        function startQuiz() {
            answers = new Array(questions.length).fill(null);
            correctCount = 0;
            incorrectCount = 0;
            answeredQuestions = new Set();
            currentQuestion = 0;
            showQuestion(0);
            updateStats();
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            document.getElementById('question-number').textContent = `Question ${index + 1} of ${questions.length}`;
            document.getElementById('question-text').innerHTML = question.text;
            document.getElementById('question-status').textContent = answers[index] ? 'Question answered' : 'Click an option to answer';

            const imagesContainer = document.getElementById('question-images');
            imagesContainer.innerHTML = '';

            if (question.imageData) {
                const img = document.createElement('img');
                img.src = `data:${question.imageData.mime};base64,${question.imageData.data}`;
                img.className = 'medical-image';
                img.alt = 'Medical Question Image';
                imagesContainer.appendChild(img);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-card w-full p-6 text-left bg-white rounded-xl shadow-lg';
                button.innerHTML = `<span class="font-bold text-blue-600 mr-4">${option.label}.</span>${option.text}`;

                if (!isTestMode && answers[index] !== null) {
                    button.disabled = true;
                    if (option.correct) {
                        button.classList.add('correct');
                    } else if (answers[index] === option.label) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option.label);
                }

                if (answers[index] === option.label) {
                    button.classList.add('selected');
                }

                optionsContainer.appendChild(button);
            });

            // Show feedback only in normal mode and if answered
            if (!isTestMode && answers[index] !== null) {
                showFeedback(index);
            } else {
                document.getElementById('feedback-section').classList.add('hidden');
            }

            document.getElementById('prev-btn').disabled = index === 0;

            if (answers[index] !== null) {
                if (index === questions.length - 1) {
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('finish-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('finish-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');
            }

            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function selectAnswer(label) {
            const question = questions[currentQuestion];
            const correctOption = question.options.find(opt => opt.correct);
            const isCorrect = correctOption && label === correctOption.label;

            if (!answeredQuestions.has(currentQuestion)) {
                answeredQuestions.add(currentQuestion);
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }

            answers[currentQuestion] = label;
            updateStats();
            
            showQuestion(currentQuestion);
        }

        function showFeedback(questionIndex) {
            const question = questions[questionIndex];
            const userAnswer = answers[questionIndex];
            const correctOption = question.options.find(opt => opt.correct);
            const userOption = question.options.find(opt => opt.label === userAnswer);
            const isCorrect = correctOption && userAnswer === correctOption.label;

            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackMessage = document.getElementById('feedback-message');

            if (isCorrect) {
                feedbackSection.className = 'bg-green-50 border border-green-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚úÖ';
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-green-700';
            } else {
                feedbackSection.className = 'bg-red-50 border border-red-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚ùå';
                feedbackMessage.textContent = 'Incorrect';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-red-700';
            }

            document.getElementById('user-answer-display').innerHTML = `<span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Unknown'}</span>`;
            document.getElementById('correct-answer-display').textContent = question.correctAnswer;

            const explanationSection = document.getElementById('explanation-section');
            if (question.explanationHTML && question.explanationHTML.trim()) {
                document.getElementById('explanation-content').innerHTML = question.explanationHTML;
                explanationSection.classList.remove('hidden');
            } else {
                explanationSection.classList.add('hidden');
            }

            feedbackSection.classList.remove('hidden');
        }

        function updateStats() {
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);

            document.getElementById('correct-stats').textContent = correctCount;
            document.getElementById('incorrect-stats').textContent = incorrectCount;
            document.getElementById('accuracy-stats').textContent = `${accuracy}%`;
            document.getElementById('progress-stats').textContent = `${totalAnswered}/${questions.length}`;
        }

        document.getElementById('prev-btn').onclick = () => {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        };
        
        document.getElementById('finish-btn').onclick = showFinalResults;

        function showFinalResults() {
            if (isTestMode) {
                showTestModeResults();
            } else {
                showNormalModeResults();
            }
        }

        function showTestModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');

            document.getElementById('test-final-correct').textContent = correctCount;
            document.getElementById('test-final-incorrect').textContent = incorrectCount;
            document.getElementById('test-final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('test-grade-icon').textContent = gradeIcon;

            // Show detailed review
            const reviewContainer = document.getElementById('test-review-details');
            reviewContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = answers[index];
                const correctOption = question.options.find(opt => opt.correct);
                const userOption = question.options.find(opt => opt.label === userAnswer);
                const isCorrect = correctOption && userAnswer === correctOption.label;

                const reviewCard = document.createElement('div');
                reviewCard.className = `border-l-4 p-4 bg-white rounded-lg shadow-sm ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                reviewCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-800">Question ${index + 1}</h4>
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${question.text}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <strong class="text-gray-600">Your Answer:</strong><br>
                            <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Not answered'}</span>
                        </div>
                        <div>
                            <strong class="text-gray-600">Correct Answer:</strong><br>
                            <span class="text-green-600">${question.correctAnswer}</span>
                        </div>
                    </div>
                    ${question.explanationHTML ? `
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                            <strong class="text-blue-800">Explanation:</strong>
                            <div class="mt-2 explanation-content">${question.explanationHTML}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
        }

        function showNormalModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('final-results').classList.remove('hidden');

            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('final-grade-icon').textContent = gradeIcon;
        }
    </script>
</body>
</html>