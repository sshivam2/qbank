<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10_Amnestic Disorders and Other Neurocognitive Dis... - Marrow Psychiatry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .medical-quiz {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .question-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: #3b82f6;
            color: white;
            border-color: #1d4ed8;
        }
        
        .option-card.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }
        
        .option-card.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        
        .progress-bar {
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.3s;
        }
        
        .medical-image {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }
        
        .hidden {
            display: none !important;
        }

        .explanation-content {
            font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.05rem;
            line-height: 1.7;
            color: #374151;
            text-align: left;
        }
        
        .explanation-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .explanation-content strong, .explanation-content b {
            font-weight: 600;
            color: #1f2937;
        }
        
        .explanation-content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen medical-quiz">
    <header class="bg-white shadow-xl p-6">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">10_Amnestic Disorders and Other Neurocognitive Dis...</h1>
                <p class="text-gray-600 mt-2">Marrow ‚Ä¢ Psychiatry ‚Ä¢ Interactive Learning</p>
            </div>
            <div class="flex gap-2">
                <button class="bg-gray-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-gray-600 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    ‚Üê Topics
                </button>
                <button class="bg-purple-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-purple-600 transition" 
                        onclick="window.location.href='marrow.html'">
                    üìö Marrow
                </button>
                <button class="bg-blue-500 text-white px-3 py-2 text-sm rounded-lg hover:bg-blue-600 transition" 
                        onclick="window.location.href='index.html'">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar (Hidden in Test Mode) -->
    <div class="bg-white shadow-lg p-4" id="stats-bar">
        <div class="container mx-auto flex justify-center gap-8">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="correct-stats">0</div>
                <div class="text-sm text-gray-600">Correct</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="incorrect-stats">0</div>
                <div class="text-sm text-gray-600">Incorrect</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="accuracy-stats">0%</div>
                <div class="text-sm text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="progress-stats">0/7</div>
                <div class="text-sm text-gray-600">Progress</div>
            </div>
        </div>
    </div>

    <!-- Quiz Section -->
    <section class="container mx-auto p-6" id="quiz-section">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4 mb-8">
                <div class="progress-bar h-4 rounded-full" id="progress-bar"></div>
            </div>

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-blue-700" id="question-number">Question 1 of 7</h2>
                <div class="text-sm text-gray-600" id="question-status">Click an option to answer</div>
            </div>

            <!-- Question Text -->
            <div class="mb-10">
                <div class="question-card text-white p-8 rounded-2xl mb-8" id="question-text"></div>
                
                <!-- Question Image -->
                <div class="text-center mb-8" id="question-images"></div>
                
                <!-- Options -->
                <div class="space-y-4" id="options"></div>
            </div>

            <!-- Answer Feedback Section (Normal Mode Only) -->
            <div class="hidden mb-8 p-6 rounded-2xl" id="feedback-section">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2" id="feedback-icon"></div>
                    <div class="text-2xl font-bold mb-2" id="feedback-message">Correct!</div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Your Answer:</strong><br>
                        <span id="user-answer-display"></span>
                    </div>
                    <div class="bg-white p-4 rounded-xl border">
                        <strong>Correct Answer:</strong><br>
                        <span class="text-green-600" id="correct-answer-display"></span>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-xl" id="explanation-section">
                    <strong class="text-lg text-blue-800">Explanation:</strong>
                    <div id="explanation-content" class="mt-3 explanation-content"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between gap-4">
                <button class="bg-gray-400 text-white px-6 py-3 rounded-xl hover:bg-gray-500 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                
                <div class="flex gap-4">
                    <button class="bg-gray-400 text-white px-6 py-3 rounded-xl disabled" id="prev-btn">
                        Previous
                    </button>
                    <button class="bg-blue-500 text-white px-6 py-3 rounded-xl hidden" id="next-btn">
                        Next
                    </button>
                    <button class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hidden" id="finish-btn">
                        Finish Quiz
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Test Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="test-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Test Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="test-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="test-final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="test-final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="test-final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>

            <!-- Detailed Review -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed Review</h3>
                <div id="test-review-details" class="space-y-4"></div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <!-- Normal Mode Final Results -->
    <section class="container mx-auto p-6 hidden" id="final-results">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4 text-blue-700">Quiz Complete! üéâ</h2>
                <div class="text-6xl mb-4" id="final-grade-icon">üéØ</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-green-600" id="final-correct">0</div>
                    <div class="font-semibold text-green-700">Correct Answers</div>
                </div>
                <div class="bg-red-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-red-600" id="final-incorrect">0</div>
                    <div class="font-semibold text-red-700">Incorrect Answers</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl text-center">
                    <div class="text-4xl font-bold text-blue-600" id="final-accuracy">0%</div>
                    <div class="font-semibold text-blue-700">Final Accuracy</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition" 
                        onclick="window.location.href='marrow_psychiatry.html'">
                    Back to Topics
                </button>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition" 
                        onclick="window.location.reload()">
                    Retake Quiz
                </button>
            </div>
        </div>
    </section>

    <script>
        const questions = [
  {
    "id": 149,
    "text": "Q1. lesion involving which of the following neuroanatomical structures is least likely to result in an amnestic disorder?",
    "options": [
      {
        "label": "A",
        "text": "Hippocampus",
        "correct": false
      },
      {
        "label": "B",
        "text": "Amygdala",
        "correct": false
      },
      {
        "label": "C",
        "text": "Arcuate nucleus",
        "correct": true
      },
      {
        "label": "D",
        "text": "Mammillary bodies",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Arcuate nucleus is not associated with amnestic disorders. The neuroanatomical structures involved in the etiology of amnestic memory include: * Mammillary bodies * Hippocampus * Amygdala * Dorsomedial and the midline thalamic nuclei</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "C. Arcuate nucleus"
  },
  {
    "id": 150,
    "text": "Q2. 32-year-old train accident survivor is being evaluated for suspected amnestic disorder. Which of the following is most likely to be impaired in this patient?",
    "options": [
      {
        "label": "A",
        "text": "Habit learning",
        "correct": false
      },
      {
        "label": "B",
        "text": "Skill learning",
        "correct": false
      },
      {
        "label": "C",
        "text": "Route navigation",
        "correct": true
      },
      {
        "label": "D",
        "text": "Classical conditioning",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Route navigation is a function of declarative memory that is impaired in patients with amnesia. Non-declarative memory is preserved in amnesia. Declarative memory supports the conscious recollection of facts and events. * Memory for routes, lists, faces, melodies, objects * Memory for other verbal and nonverbal material Non-declarative memory includes: 133 ¬¢ Skill learning * Habit learning * Simple forms of conditioning</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "C. Route navigation"
  },
  {
    "id": 151,
    "text": "Q3. After detailed neuropsychiatric evaluation, an ICU patient was found to have severe retrograde amnesia with largely preserved anterograde memory. Which of the following is the most likely explanation for this presentation?",
    "options": [
      {
        "label": "A",
        "text": "Post-traumatic stress disorder",
        "correct": true
      },
      {
        "label": "B",
        "text": "Head injury",
        "correct": false
      },
      {
        "label": "C",
        "text": "Alcohol-related dementia",
        "correct": false
      },
      {
        "label": "D",
        "text": "Korsakoff syndrome",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Severe retrograde amnesia with minimal or no anterograde amnesia is seen in post-traumatic stress disorder. It is referred to as dissociative/psychogenic amnesia. It is also known as hysterical amnesia or functional amnesia. Psychogenic amnesia presents with a sudden onset of: * Extensive and severe retrograde amnesia ¬¢ A loss of personal identity - unable to recall their own name, information from childhood, or from their past. * Minimal anterograde amnesia The other given options can all cause both retrograde and anterograde amnesia.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "A. Post-traumatic stress disorder"
  },
  {
    "id": 152,
    "text": "Q4. 131 What does Ribot‚Äôs law deal with?",
    "options": [
      {
        "label": "A",
        "text": "Anterograde amnesia",
        "correct": false
      },
      {
        "label": "B",
        "text": "Retrograde amnesia",
        "correct": true
      },
      {
        "label": "C",
        "text": "Dissociative amnesia",
        "correct": false
      },
      {
        "label": "D",
        "text": "Global transient amnesia",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Ribot's law deals with retrograde amnesia. During incidents of retrograde amnesia, most recently acquired memories are the most vulnerable to disruption from brain damage. This temporal gradation of retrograde amnesia that preferentially spares the more distant memories is known as Ribot's law. E. g: If an incident causing retrograde amnesia occurs at 30 years of age, the memories acquired at 25 years of age may be more severely affected than those memories acquired at 20 years of age or earlier.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "B. Retrograde amnesia"
  },
  {
    "id": 153,
    "text": "Q5. Which of the following is not a feature of mild neurocognitive disorder?",
    "options": [
      {
        "label": "A",
        "text": "Cognitive decline from previous level in one or more cognitive domain",
        "correct": false
      },
      {
        "label": "B",
        "text": "The deficit occurs exclusively during an episode of delirium",
        "correct": true
      },
      {
        "label": "C",
        "text": "Do not interfere with independence in daily activities",
        "correct": false
      },
      {
        "label": "D",
        "text": "Mini mental state examination score of 26",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">Mild neurocognitive disorder does not occur exclusively during an episode of delirium. Mild neurocognitive disorder or Mild Cognitive Impairment (MCI) is a level of cognitive impairment which is: * Not severe enough to be diagnosed as dementia * Not mild enough to be called a part of the normal aging process. General Criteria for Mild Cognitive Impairment: * Not normal, but does not meet criteria for dementia syndrome either. * Cognitive decline: 134 * The patient and/or informant report an impairment in objective cognitive tasks. * Evidence of decline over time in objective cognitive tasks. * Preserved basic activities of daily living/minimal impairment in complex instrumental functions. * MMSE score between 25-27 (out of 30) Single domain amnestic Mild Cognitive Impairment usually progresses to Alzheimer's disease.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "B. The deficit occurs exclusively during an episode of delirium"
  },
  {
    "id": 154,
    "text": "Q6. 72-year-old man was taken to the psychiatrist by his son for memory issues. The elderly man had been living in his own house for the past 40 years, where he used to ritually water his garden every day after breakfast. Recently he moved to his son‚Äôs flat in Delhi but forgets this, and continues to get ready after breakfast to go and water his garden. Neuropsychiatric evaluation is normal except for some mild cognitive impairment. What is this phenomenon called?",
    "options": [
      {
        "label": "A",
        "text": "Retroactive interference",
        "correct": false
      },
      {
        "label": "B",
        "text": "Proactive interference",
        "correct": true
      },
      {
        "label": "C",
        "text": "Output interference",
        "correct": false
      },
      {
        "label": "D",
        "text": "Biological Amnesia",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given clinical scenario in which information stored earlier interferes with the retrieval of new information is called proactive interference. Option A: Retroactive Interference - new information interferes with the retrieval of information stored earlier. Option C: Output interference - the initial act of recalling particular information interferes with the retrieval of the original information. For example, When trying to remember a limited number of items, such as a list of words or the names of individuals in a group, recalling some items can make it more difficult to recall other items in the same collection. Option D: Biological Amnesia - amnesia due to brain damage.</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "B. Proactive interference"
  },
  {
    "id": 155,
    "text": "Q7. 42-year-old man had a fall followed by one episode of vomiting. When brought to the casualty, he was awake and conscious but had unrelieved anterograde amnesia. Which of the following is the most likely cause?",
    "options": [
      {
        "label": "A",
        "text": "Drunkenness ee ee ee ee ee Detailed Explanations Solution to Question 1: Arcuate nucleus is not associated with amnestic disorders. The neuroanatomical structures involved in the etiology of amnestic memory include: * Mammillary bodies * Hippocampus * Amygdala * Dorsomedial and the midline thalamic nuclei Solution to Question 2: Route navigation is a function of declarative memory that is impaired in patients with amnesia. Non-declarative memory is preserved in amnesia. Declarative memory supports the conscious recollection of facts and events. * Memory for routes, lists, faces, melodies, objects * Memory for other verbal and nonverbal material Non-declarative memory includes: 133",
        "correct": false
      },
      {
        "label": "B",
        "text": "Diffuse axonal injury 132",
        "correct": false
      },
      {
        "label": "C",
        "text": "Concussion",
        "correct": true
      },
      {
        "label": "D",
        "text": "Cerebral venous thrombosis",
        "correct": false
      }
    ],
    "imageData": null,
    "explanationHTML": "<div class=\"explanation\">The given history of fall and anterograde amnesia points towards the diagnosis of concussion. A concussion is the most common type of traumatic brain injury. It can result from vehicle accidents, falls, sports injuries, etc. Anterograde amnesia/post-traumatic amnesia is the hallmark of a concussion. In this type of amnesia, the events following the injury cannot be recalled. Other clinical features of concussion include headache, dizziness, nausea, and vomiting. Option A: Drunkenness - the patient will be drowsy or sleepy and not awake. Option B: Diffuse axonal injury - seen in high-speed deceleration which causes disruption and shearing of axons leading to microhemorrhages. Usually results in a persistent vegetative stage. Option D: Cerebral venous thrombosis - acute thrombosis in dural venous sinuses; manifests as headache, visual abnormalities, or seizures. 135</div><div class=\"telegram-link\"><small><a href=\"http://t.me/Friendly_neighborhood_medico_bot\"> </a></small></div>",
    "subdeck": "10_Amnestic Disorders and Other Neurocognitive Dis...",
    "deck_id": 1755954606720,
    "correctAnswer": "C. Concussion"
  }
];
        let currentQuestion = 0;
        let answers = [];
        let correctCount = 0;
        let incorrectCount = 0;
        let answeredQuestions = new Set();
        let isTestMode = localStorage.getItem('testMode') === 'true' || false;

        console.log('Quiz loaded with', questions.length, 'questions');
        console.log('Test mode:', isTestMode);

        // Hide stats bar if test mode is enabled
        if (isTestMode) {
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('stats-bar').style.display = 'none';
            });
        }

        // Auto-start quiz
        startQuiz();

        function startQuiz() {
            answers = new Array(questions.length).fill(null);
            correctCount = 0;
            incorrectCount = 0;
            answeredQuestions = new Set();
            currentQuestion = 0;
            showQuestion(0);
            updateStats();
        }

        function showQuestion(index) {
            currentQuestion = index;
            const question = questions[index];

            document.getElementById('question-number').textContent = `Question ${index + 1} of ${questions.length}`;
            document.getElementById('question-text').innerHTML = question.text;
            document.getElementById('question-status').textContent = answers[index] ? 'Question answered' : 'Click an option to answer';

            const imagesContainer = document.getElementById('question-images');
            imagesContainer.innerHTML = '';

            if (question.imageData) {
                const img = document.createElement('img');
                img.src = `data:${question.imageData.mime};base64,${question.imageData.data}`;
                img.className = 'medical-image';
                img.alt = 'Medical Question Image';
                imagesContainer.appendChild(img);
            }

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-card w-full p-6 text-left bg-white rounded-xl shadow-lg';
                button.innerHTML = `<span class="font-bold text-blue-600 mr-4">${option.label}.</span>${option.text}`;

                if (!isTestMode && answers[index] !== null) {
                    button.disabled = true;
                    if (option.correct) {
                        button.classList.add('correct');
                    } else if (answers[index] === option.label) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option.label);
                }

                if (answers[index] === option.label) {
                    button.classList.add('selected');
                }

                optionsContainer.appendChild(button);
            });

            // Show feedback only in normal mode and if answered
            if (!isTestMode && answers[index] !== null) {
                showFeedback(index);
            } else {
                document.getElementById('feedback-section').classList.add('hidden');
            }

            document.getElementById('prev-btn').disabled = index === 0;

            if (answers[index] !== null) {
                if (index === questions.length - 1) {
                    document.getElementById('next-btn').classList.add('hidden');
                    document.getElementById('finish-btn').classList.remove('hidden');
                } else {
                    document.getElementById('next-btn').classList.remove('hidden');
                    document.getElementById('finish-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');
            }

            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function selectAnswer(label) {
            const question = questions[currentQuestion];
            const correctOption = question.options.find(opt => opt.correct);
            const isCorrect = correctOption && label === correctOption.label;

            if (!answeredQuestions.has(currentQuestion)) {
                answeredQuestions.add(currentQuestion);
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }

            answers[currentQuestion] = label;
            updateStats();
            
            showQuestion(currentQuestion);
        }

        function showFeedback(questionIndex) {
            const question = questions[questionIndex];
            const userAnswer = answers[questionIndex];
            const correctOption = question.options.find(opt => opt.correct);
            const userOption = question.options.find(opt => opt.label === userAnswer);
            const isCorrect = correctOption && userAnswer === correctOption.label;

            const feedbackSection = document.getElementById('feedback-section');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackMessage = document.getElementById('feedback-message');

            if (isCorrect) {
                feedbackSection.className = 'bg-green-50 border border-green-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚úÖ';
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-green-700';
            } else {
                feedbackSection.className = 'bg-red-50 border border-red-200 mb-8 p-6 rounded-2xl';
                feedbackIcon.textContent = '‚ùå';
                feedbackMessage.textContent = 'Incorrect';
                feedbackMessage.className = 'text-2xl font-bold mb-2 text-red-700';
            }

            document.getElementById('user-answer-display').innerHTML = `<span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Unknown'}</span>`;
            document.getElementById('correct-answer-display').textContent = question.correctAnswer;

            const explanationSection = document.getElementById('explanation-section');
            if (question.explanationHTML && question.explanationHTML.trim()) {
                document.getElementById('explanation-content').innerHTML = question.explanationHTML;
                explanationSection.classList.remove('hidden');
            } else {
                explanationSection.classList.add('hidden');
            }

            feedbackSection.classList.remove('hidden');
        }

        function updateStats() {
            const totalAnswered = correctCount + incorrectCount;
            const accuracy = totalAnswered === 0 ? 0 : Math.round((correctCount / totalAnswered) * 100);

            document.getElementById('correct-stats').textContent = correctCount;
            document.getElementById('incorrect-stats').textContent = incorrectCount;
            document.getElementById('accuracy-stats').textContent = `${accuracy}%`;
            document.getElementById('progress-stats').textContent = `${totalAnswered}/${questions.length}`;
        }

        document.getElementById('prev-btn').onclick = () => {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        };
        
        document.getElementById('next-btn').onclick = () => {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        };
        
        document.getElementById('finish-btn').onclick = showFinalResults;

        function showFinalResults() {
            if (isTestMode) {
                showTestModeResults();
            } else {
                showNormalModeResults();
            }
        }

        function showTestModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('test-results').classList.remove('hidden');

            document.getElementById('test-final-correct').textContent = correctCount;
            document.getElementById('test-final-incorrect').textContent = incorrectCount;
            document.getElementById('test-final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('test-grade-icon').textContent = gradeIcon;

            // Show detailed review
            const reviewContainer = document.getElementById('test-review-details');
            reviewContainer.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = answers[index];
                const correctOption = question.options.find(opt => opt.correct);
                const userOption = question.options.find(opt => opt.label === userAnswer);
                const isCorrect = correctOption && userAnswer === correctOption.label;

                const reviewCard = document.createElement('div');
                reviewCard.className = `border-l-4 p-4 bg-white rounded-lg shadow-sm ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                reviewCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-800">Question ${index + 1}</h4>
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${question.text}</p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <strong class="text-gray-600">Your Answer:</strong><br>
                            <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${userAnswer}. ${userOption?.text || 'Not answered'}</span>
                        </div>
                        <div>
                            <strong class="text-gray-600">Correct Answer:</strong><br>
                            <span class="text-green-600">${question.correctAnswer}</span>
                        </div>
                    </div>
                    ${question.explanationHTML ? `
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                            <strong class="text-blue-800">Explanation:</strong>
                            <div class="mt-2 explanation-content">${question.explanationHTML}</div>
                        </div>
                    ` : ''}
                `;
                
                reviewContainer.appendChild(reviewCard);
            });
        }

        function showNormalModeResults() {
            const accuracy = (correctCount + incorrectCount === 0) ? 0 : Math.round((correctCount / (correctCount + incorrectCount)) * 100);

            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('final-results').classList.remove('hidden');

            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;

            let gradeIcon = 'üéØ';
            if (accuracy >= 90) {
                gradeIcon = 'üèÜ';
            } else if (accuracy >= 80) {
                gradeIcon = 'üéâ';
            } else if (accuracy >= 70) {
                gradeIcon = 'üëç';
            } else if (accuracy >= 60) {
                gradeIcon = 'üìö';
            } else {
                gradeIcon = 'üí™';
            }

            document.getElementById('final-grade-icon').textContent = gradeIcon;
        }
    </script>
</body>
</html>